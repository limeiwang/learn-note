<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS运行机制 | Limw</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Limw,源码解析,前端,Vue,Vue3,Es6,Javascript">
    
    <link rel="preload" href="/assets/css/0.styles.d32c054f.css" as="style"><link rel="preload" href="/assets/js/app.d126f102.js" as="script"><link rel="preload" href="/assets/js/2.b5785120.js" as="script"><link rel="preload" href="/assets/js/3.c871008b.js" as="script"><link rel="prefetch" href="/assets/js/10.3e0dcbdd.js"><link rel="prefetch" href="/assets/js/11.594f2dfb.js"><link rel="prefetch" href="/assets/js/12.8c2ee3d2.js"><link rel="prefetch" href="/assets/js/13.381f064d.js"><link rel="prefetch" href="/assets/js/14.c91cd66c.js"><link rel="prefetch" href="/assets/js/15.242b0cf4.js"><link rel="prefetch" href="/assets/js/16.ebc351f9.js"><link rel="prefetch" href="/assets/js/17.738eac1b.js"><link rel="prefetch" href="/assets/js/18.fe3744ea.js"><link rel="prefetch" href="/assets/js/19.dace192a.js"><link rel="prefetch" href="/assets/js/20.2f94866e.js"><link rel="prefetch" href="/assets/js/21.2c87ec99.js"><link rel="prefetch" href="/assets/js/22.1e253cea.js"><link rel="prefetch" href="/assets/js/23.feeaf889.js"><link rel="prefetch" href="/assets/js/24.bd8a0e25.js"><link rel="prefetch" href="/assets/js/25.9edf1021.js"><link rel="prefetch" href="/assets/js/26.274a37df.js"><link rel="prefetch" href="/assets/js/27.1939e8fd.js"><link rel="prefetch" href="/assets/js/28.6afbafd3.js"><link rel="prefetch" href="/assets/js/29.1f4ccd1f.js"><link rel="prefetch" href="/assets/js/30.035667de.js"><link rel="prefetch" href="/assets/js/31.66989e5c.js"><link rel="prefetch" href="/assets/js/32.83238fdd.js"><link rel="prefetch" href="/assets/js/33.10bd14b6.js"><link rel="prefetch" href="/assets/js/34.3418bbce.js"><link rel="prefetch" href="/assets/js/4.92571595.js"><link rel="prefetch" href="/assets/js/5.dfe92a24.js"><link rel="prefetch" href="/assets/js/6.c3ffaf1c.js"><link rel="prefetch" href="/assets/js/7.3eb840b4.js"><link rel="prefetch" href="/assets/js/8.7de7f37c.js"><link rel="prefetch" href="/assets/js/9.c8d254f7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d32c054f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Limw</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/lmw0221" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/lmw0221" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深入浅出 Vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue2 &amp;&amp; React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/css/mobile.html" class="sidebar-link">移动端-适配</a></li><li><a href="/css/layout.html" class="sidebar-link">PC端-布局</a></li><li><a href="/sse/optimization.html" class="sidebar-link">性能优化</a></li><li><a href="/sse/event_loop.html" aria-current="page" class="active sidebar-link">JS运行机制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/browser/garbage_collection.html" class="sidebar-link">JS垃圾回收机制</a></li><li><a href="/review/css_base.html" class="sidebar-link">CSS基础篇</a></li><li><a href="/review/js_type.html" class="sidebar-link">JS数据类型篇</a></li><li><a href="/review/js_function.html" class="sidebar-link">JS函数篇</a></li><li><a href="/review/webpack.html" class="sidebar-link">Webpack篇</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写代码合集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>经验之谈</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/Node.html" class="sidebar-link">Node</a></li><li><a href="/TypeScript.html" class="sidebar-link">TypeScript</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js运行机制"><a href="#js运行机制" class="header-anchor">#</a> JS运行机制</h1> <blockquote><p>Javascript是一种单线程开发语言。理解Javascript的运行机制是日常编码必须要掌握的技能。</p></blockquote> <p>会讲述以下内容</p> <ol><li>JS单进程的优缺点</li> <li>Event Loop</li> <li>宏任务和微任务</li> <li>实例讲解</li></ol> <h3 id="为什么是单线程"><a href="#为什么是单线程" class="header-anchor">#</a> 为什么是单线程？</h3> <p>JavaScript的主要用途是与用户交互，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。</p> <ul><li>假设：如果JavaScript支持多线程，一个线程在某个DOM节点上添加内容，另外一个线程删除了这个节点，那么浏览器该以哪个线程为准呢？</li></ul> <p>单线程也避免了多线程的线程创建、线程上下文切换的开销。（Nginx 也是单线程的）</p> <h3 id="单线程的缺点"><a href="#单线程的缺点" class="header-anchor">#</a> 单线程的缺点</h3> <p>单线程就意味着容易发生线程等待资源，cpu空闲，而其他任务一直等待的问题。</p> <h3 id="什么是event-loop-事件循环"><a href="#什么是event-loop-事件循环" class="header-anchor">#</a> 什么是Event Loop（事件循环）</h3> <p>为了协调事件、用户交互、脚本、UI 渲染和网络处理等行为，防止主线程阻塞。于是Javascript设计者将所有任务分为两种，一种是同步任务，一种是异步任务</p> <ul><li><p>同步任务指的是，在<code>主线程</code>上排队执行的任务</p> <ul><li>同步任务只有前一个任务执行完毕，才能执行下一个任务。</li> <li>同步任务都在主线程上执行，形成一个<code>执行栈</code> <ul><li>每次执行栈执行的代码就是一个宏任务</li></ul></li></ul></li> <li><p>异步任务指的是，不进入主线程，而进入任务队列的任务。</p> <ul><li>只要指定过回调函数，这些事件发生时就会进入&quot;任务队列&quot;（比如鼠标点击...等）</li> <li>一旦<code>执行栈中的所有同步任务执行完毕</code>，系统就会读取“任务队列”。</li> <li>任务队列是一个先进先出的数据结构，排在前面的事件，优先被主线程读取。</li></ul></li></ul> <p>&quot;主线程&quot;从&quot;任务队列&quot;中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop（事件循环）。</p> <h3 id="宏任务和微任务"><a href="#宏任务和微任务" class="header-anchor">#</a> 宏任务和微任务</h3> <p>根据规范：每个任务都有一个任务源(task source)，源自同一个任务源的 task 必须放到同一个任务队列，从不同源来的则被添加到不同队列，所以有了宏任务(macro)task和微任务(micro)task。</p> <p>浏览器为了能够使得JS内部(macro)task与DOM任务能够有序的执行，会在<strong>一个task执行结束后，在下一个(macro)task 执行开始前，对页面进行重新渲染，</strong></p> <p><strong>每次执行完一个宏任务之后，会去检查是否存在微任务；<strong>如果有，则执行微任务直至</strong>清空微任务队列</strong>（如果在微任务执行期间微任务队列加入了新的微任务，会将新的微任务加入队列尾部，之后也会被执行）。</p> <p>根据上述总结流程为：</p> <p><img src="/assets/img/event_loop.c3f59522.c3f59522.jpg" alt=""></p> <p>附（宏/微任务清单）：</p> <ul><li>宏任务(macro)task主要有：
script(整体代码)、setTimeout、setInterval、I/O、UI交互事件、postMessage、MessageChannel、setImmediate(Node.js 环境)</li> <li>微任务(micro)task主要有： Promise.then、MutaionObserver、process.nextTick(Node.js 环境)</li></ul> <h3 id="实例分析"><a href="#实例分析" class="header-anchor">#</a> 实例分析</h3> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>

<span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> intersectionObserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>intersectionRatio <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'LoadedNewItems'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'doSomething'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开始监听</span>
intersectionObserver<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">reslove</span> <span class="token operator">=&gt;</span> <span class="token function">reslove</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><p>以上案例会打印 1 10 2 5 -&gt; undefined -&gt; 8 9 LoadedNewItems doSomething 6 7 3 4 如果没有 intersectionObserver 会打印 1 10 2 5 -&gt; undefined -&gt; 8 9 3 4 6 7</p> <p>结果解析：</p> <ol><li>JavaScript执行主线程任务：<code>打印 1 10</code> <ul><li>附：Promise构造器内部是同步任务</li></ul></li> <li>执行微任务队列：<code>打印 2 5</code></li> <li>宏任务和微任务都执行完成：<code>打印 undefined</code></li> <li>执行<code>requestAnimationFrame</code> ，打印<code>8</code></li> <li>执行<code>requestAnimationFrame</code>的微任务，打印<code>9</code></li> <li>执行<code>IntersectionObserver</code>，打印 <code>LoadedNewItems</code></li> <li>执行<code>IntersectionObserver</code>的微任务，打印 <code>doSomething</code></li> <li>更新界面</li> <li>如果浏览器空闲，调用<code>requestIdleCallback</code>，打印 <code>3</code> <ul><li>如果r<code>equestIdleCallback</code>被调用，那么会继续执行微任务，打印 <code>4</code></li></ul></li> <li>一帧结束：</li> <li>下一帧开始：执行<code>settimeout</code>，打印 <code>6</code></li> <li>执行<code>settimeout</code>的微任务，打印 <code>7</code></li></ol> <h3 id="结论"><a href="#结论" class="header-anchor">#</a> 结论</h3> <ol><li>宏任务</li> <li>微任务</li> <li>requestAnimationFrame</li> <li>IntersectionObserver</li> <li>更新界面</li> <li>requestIdleCallback</li> <li>下一帧</li></ol> <p>JavaScript引擎是单线程运行的，浏览器无论在什么时候都只且只有一个线程在运行JavaScript程序。</p> <p>浏览器的内核是多线程的，它们在内核制控下相互配合以保持同步，一个浏览器至少实现三个常驻线程：javascript引擎线程，GUI渲染线程，浏览器事件触发线程。这些异步线程都会产生不同的异步的事件。</p> <ol><li>javascript引擎是基于事件驱动单线程执行的，JS引擎一直等待着任务队列中任务的到来，然后加以处理，浏览器无论什么时候都只有一个JS线程在运行JS程序。</li> <li>GUI渲染线程负责渲染浏览器界面，当界面需要重绘（Repaint）或由于某种操作引发回流(reflow)时,该线程就会执行。但需要注意 GUI渲染线程与JS引擎是互斥的，当JS引擎执行时GUI线程会被挂起，GUI更新会被保存在一个队列中等到JS引擎空闲时立即被执行。</li> <li>事件触发线程，当一个事件被触发时该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理。这些事件可来自JavaScript引擎当前执行的代码块如setTimeOut、也可来自浏览器内核的其他线程如鼠标点击、AJAX异步请求等，但由于JS的单线程关系所有这些事件都得排队等待JS引擎处理。（当线程中没有执行任何同步代码的前提下才会执行异步代码）。</li></ol> <p>当程序启动时, 一个进程被创建，同时也运行一个线程, 即为主线程，js的运行机制为单线程
<img src="/assets/img/browser.1b21d94a.png" alt="浏览器单线程"></p> <p>程序中跑两个线程，一个负责程序本身的运行，作为主线程； 另一个负责主线程与其他线程的的通信，被称为“Event Loop 线程&quot; 。每当遇到异步任务，交给 EventLoop 线程，然后自己往后运行，等到主线程运行完后，再去 EventLoop 线程拿结果。</p> <ol><li>所有任务都在主线程上执行，形成一个执行栈（execution context stack）。</li> <li>主线程之外，还存在一个&quot;任务队列&quot;（task queue）。系统把异步任务放到&quot;任务队列&quot;之中，然后继续执行后续的任务。</li> <li>一旦&quot;执行栈&quot;中的所有任务执行完毕，系统就会读取&quot;任务队列&quot;。如果这个时候，异步任务已经结束了等待状态，就会从&quot;任务队列&quot;进入执行栈，恢复执行。</li> <li>主线程不断重复上面的第三步。</li></ol> <p>&quot;回调函数&quot;（callback），就是那些会被主线程挂起来的代码。异步任务必须指定回调函数，当异步任务从&quot;任务队列&quot;回到执行栈，回调函数就会执行。&quot;任务队列&quot;是一个先进先出的数据结构，排在前面的事件，优先返回主线程。主线程的读取过程基本上是自动的，只要执行栈一清空，&quot;任务队列&quot;上第一位的事件就自动返回主线程。</p> <p>主线程从&quot;任务队列&quot;中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop。</p> <h3 id="从主线程的角度看-一个异步过程包括下面两个要素"><a href="#从主线程的角度看-一个异步过程包括下面两个要素" class="header-anchor">#</a> 从主线程的角度看，一个异步过程包括下面两个要素：</h3> <p>发起函数(或叫注册函数)A
回调函数callbackFn
它们都是在主线程上调用的，其中注册函数用来发起异步过程，回调函数用来处理结果。</p> <h3 id="异步进程有"><a href="#异步进程有" class="header-anchor">#</a> 异步进程有:</h3> <p>类似onclick等，由浏览器内核的DOM binding模块处理，事件触发时，回调函数添加到任务队列中；
setTimeout等，由浏览器内核的Timer模块处理，时间到达时，回调函数添加到任务队列中；
Ajax，由浏览器内核的Network模块处理，网络请求返回后，添加到任务队列中。</p> <p>例如setTimeout(fn, 1000)，其中的setTimeout就是异步过程的发起函数，fn是回调函数。用一句话概括：工作线程将消息放到消息队列，主线程通过事件循环过程去取消息。</p> <p>消息队列：消息队列是一个先进先出的队列，它里面存放着各种消息。
事件循环：事件循环是指主线程重复从消息队列中取消息、执行的过程。</p> <p><img src="/assets/img/eventloop.f72b0c89.png" alt=""></p> <p>流程如下:</p> <ol><li>主线程读取js代码, 形成相应的堆和执行栈, 执行同步任务</li> <li>当主线程遇到异步任务,，指定给异步进程处理, 同时继续执行同步任务</li> <li>当异步进程处理完毕后， 将相应的异步任务推入到任务队列首部</li> <li>主线程任务处理完毕后,，查询任务队列，则取出一个任务队列推入到主线程的执行栈</li> <li>重复执行第2、3、4步，这就称为事件循环</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sse/optimization.html" class="prev">
        性能优化
      </a></span> <span class="next"><a href="/browser/garbage_collection.html">
        JS垃圾回收机制
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d126f102.js" defer></script><script src="/assets/js/2.b5785120.js" defer></script><script src="/assets/js/3.c871008b.js" defer></script>
  </body>
</html>
